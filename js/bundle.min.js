var version="1.7.1";function Path(){this.path="/";Path.prototype.isValidDirectory=function(a){if(a==""){return false}var b=a.replace(/[^A-Za-z\d\-_~]/,"");if(b.length!=a.length){return false}return true};Path.prototype.isValidFilename=function(b){if(b==""){return false}var c=b.replace(/[^A-Za-z\d\.\-_~]/,"");c=c.replace(/^\.|\.$/g,"");if(c.length!=b.length){return false}var a=c.match(/\./g);if(a!=null&&a.length>1){return false}return true};Path.prototype.isValidDirectoryPath=function(a){if(a==""){return false}var b=a.replace(/[^A-Za-z\d\/\-_~]/,"");b=b.replace(/(\/)\/+/g,"$1");if(b.length!=a.length){return false}return true};Path.prototype.getDirectoryPart=function(a,b){var c="";if(a==""){return false}if(b&&this.isValidDirectory(a)){c=a}else{if(!b&&this.isValidFilename(a)){return false}else{c=a.substring(0,a.lastIndexOf("/"))}}return c+"/"};Path.prototype.getFilenamePart=function(b,a){if(b==""){return false}if(a&&this.isValidFilename(b)){return b}else{if(!a&&this.isValidDirectory(b)){return false}}var c=b.split("\\").pop().split("/").pop();if(c==""){return false}return c};Path.prototype.parseDirPathToSelector=function(c){if(c=="/"||c=="~"){return"d[path='/'][name='/']"}c=c.replace(/\/+$/,"");var a=c.split("\\").pop().split("/").pop();var b=c.substring(0,c.lastIndexOf("/")+1);return"d[path='"+b+a+"/'][name='"+a+"']"};Path.prototype.parseFilePathToSelector=function(c){var a=c.split("\\").pop().split("/").pop();var b=c.substring(0,c.lastIndexOf("/")+1);return"f[path='"+b+"'][name='"+a+"']"}}var Terminal=(function(){var k={};k.pathMgr=new Path();var e=38,g=40,h=9,c=20;var d=function(m,q,l){var p=q.parentNode.cloneNode(true);var o=document.querySelectorAll("[contenteditable=true]");for(var n=0;n<o.length;n++){o[n].setAttribute("contenteditable",false)}if(k.prompt){p.querySelector(".prompt").textContent=k.prompt}if((typeof l!=="undefined")&&l){while(m.firstChild){m.removeChild(m.firstChild)}}m.appendChild(p);p.querySelector(".prompt").innerHTML=k.customPrompt();p.querySelector(".input").innerHTML=" ";p.querySelector(".input").focus()};var b=function(m,n,l){m.innerHTML+="<div>"+(k.commands[n].exe(l))+"</div>"};var i=function(l){if(k.history.length>=c){k.history.shift()}k.history.push(l);localStorage.setItem("history",k.history);k.historyIndex=k.history.length};var a=function(o,q){var p=false;if(q==e&&k.historyIndex>0){o.textContent=k.history[--k.historyIndex];p=true}else{if(q==g){if(k.historyIndex<k.history.length){++k.historyIndex}if(k.historyIndex<k.history.length){o.textContent=k.history[k.historyIndex]}else{o.textContent=" "}p=true}}if(p){try{var l=document.createRange();var n=window.getSelection();l.setStart(o.childNodes[0],o.textContent.length);l.collapse(true);n.removeAllRanges();n.addRange(l)}catch(m){}}};var j=function(m){var l=k.commands,n=new RegExp("^"+m,"ig"),p=[];for(var o in l){if(l.hasOwnProperty(o)&&o.match(n)){p.push(o)}}return p};var f=function(){var l;if(typeof(XMLSerializer)!=="undefined"){l=(new XMLSerializer()).serializeToString(k.filesystem)}else{if("outerHTML" in k.filesystem){l=k.filesystem.outerHTML}else{l=originalFilesystem}}localStorage.setItem("filesystem",l)};k.bootTerminalStart=function(n){var m="Type 'help' to get started.";if(typeof bootMessageLines==="undefined"){bootMessageLines=[m]}if((typeof useBootLoader!=="undefined")&&!useBootLoader){bootMessageLines=[m]}var o=document.getElementById("boot");if(o==null){var l=document.createElement("p");l.setAttribute("id","boot");n.insertBefore(l,n.firstChild)}o=document.getElementById("boot");k.bootTerminalMessage(n,o,bootMessageLines,0)};k.bootTerminalMessage=function(o,m,l,n){if(n==0){o.querySelector(".hidden").style.display="none";m.innerHTML=""}m.innerHTML+=l[n];if(n+1 in l){setTimeout(function(){k.bootTerminalMessage(o,m,l,n+1)},500)}else{o.querySelector(".hidden").style.display="";o.querySelector(".input").focus()}};k.catFile=function(n){var m=null;var l="";if(n.substr(0,1)!="/"){var l=k.pathMgr.parseFilePathToSelector(k.path+n);var m=k.filesystemPointer.querySelector(l)}if(typeof m==="undefined"||m==null||m.nodeName!="f"){l=k.pathMgr.parseFilePathToSelector(n);var m=k.filesystem.querySelector(l);if(typeof m==="undefined"||m==null||m.nodeName!="f"){return false}}return m.querySelector("contents").innerHTML};k.changeDirectory=function(m){if(m==".."){if(k.filesystemPointer.getAttribute("name")!="/"){k.filesystemPointer=k.filesystemPointer.parentNode.parentNode;k.path=k.filesystemPointer.getAttribute("path");m=k.path;return true}return true}if(m=="."){return true}if(!k.pathMgr.isValidDirectoryPath(m)){return false}var l=k.findDirectory(m);if(l===false){return false}k.path=l.getAttribute("path");if(k.path.substr(-1)!="/"){k.path+="/"}m=k.path;k.filesystemPointer=l;return true};k.findDirectory=function(n){var m=null;var l="";if(n.substr(0,1)!="/"){var l=k.pathMgr.parseDirPathToSelector(k.path+n);var m=k.filesystemPointer.querySelector(l)}if(typeof m==="undefined"||m==null||m.nodeName!="d"){l=k.pathMgr.parseDirPathToSelector(n);var m=k.filesystem.querySelector(l);if(typeof m==="undefined"||m==null||m.nodeName!="d"){return false}}return m};k.deleteFile=function(m){if(!k.pathMgr.isValidFilename(m)){return"rm: Supplied filename is not valid."}var n=k.filesystemPointer.querySelector("c");var l=n.querySelector("f[path='"+k.path+"'][name='"+m+"']");if(l===null){return"rm: No such file."}n.removeChild(l);f();return true};k.makeFile=function(n){if(!k.pathMgr.isValidFilename(n)){return"touch: Supplied filename is not valid."}var o=k.filesystemPointer.querySelector("c");var m=o.querySelector("f[path='"+k.path+"'][name='"+n+"']");if(m!=null){return"touch: File already exists."}var l=document.createElement("f");l.setAttribute("name",n);l.setAttribute("path",k.path);l.innerHTML="<contents></contents>";o.appendChild(l);f();return true};k.init=function(l,m,n){k.commands=m;k.customPrompt=n;k.initSession();l.addEventListener("keydown",function(p){if(p.keyCode==h){var s=p.target;var r=j(s.textContent.replace(/\s+/g,""));if(r.length==1){s.textContent=r[0];var o=document.createRange();var q=window.getSelection();o.setStart(s.childNodes[0],r[0].length);o.collapse(true);q.removeAllRanges();q.addRange(o)}p.preventDefault(true);return false}});l.addEventListener("keyup",function(o){if(k.historyIndex<0){return}a(o.target,o.keyCode)});l.addEventListener("keypress",function(q){var r=q.target;if(q.keyCode!=13){return false}var o=r.textContent.trim();var p=o.match(/(?=\S)[^"\s]*(?:"[^\\"]*(?:\\[\s\S][^\\"]*)*"[^"\s]*)*/g);if(p==null){d(l,r,false);q.preventDefault();return}p=p.map(function(s){if(s.charAt(0)==='"'&&s.charAt(s.length-1)==='"'){return s.substr(1,s.length-2)}else{return s}});if(p[0]){if(p[0].toLowerCase() in k.commands){b(l,p[0].toLowerCase(),p);i(r.textContent)}else{l.innerHTML+=p[0]+": command not found"}}d(l,r,(["clear","reboot"].indexOf(p[0].toLowerCase())>=0));q.preventDefault()});l.querySelector(".prompt").innerHTML=k.customPrompt();l.querySelector(".input").focus();k.term=l;k.bootTerminalStart(document.getElementById("terminal"));return k};k.initSession=function(){k.history=(localStorage.getItem("history")?localStorage.getItem("history").split(","):[]);k.historyIndex=k.history.length;var l=(localStorage.getItem("filesystem")?localStorage.getItem("filesystem"):originalFilesystem);k.filesystem=(new DOMParser).parseFromString(l,"text/xml");k.path="/";path=k.path;k.filesystemPointer=k.filesystem.querySelector("d")};return k})();function extendObject(c,a){for(var b in a){a.hasOwnProperty(b)&&(c[b]=a[b])}return c}var bootMessageLines=["System loading...<br>",(new Date()).toString()+"<br>","&nbsp;_______&nbsp;&nbsp;&nbsp;______&nbsp;<br>|__&nbsp;&nbsp;&nbsp;__|&nbsp;|&nbsp;&nbsp;____|<br>&nbsp;&nbsp;&nbsp;|&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;|__&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;|&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;__|&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;|&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;|_|&nbsp;&nbsp;&nbsp;&nbsp;|_|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>","Terminal Faker version "+version+"<br>","By Sherri Wheeler (SyntaxSeed.com)<br>","Ready. Type 'help' to get started.<br><br>"];"use strict";function _instanceof(b,a){if(a!=null&&typeof Symbol!=="undefined"&&a[Symbol.hasInstance]){return a[Symbol.hasInstance](b)}else{return b instanceof a}}function _classCallCheck(a,b){if(!_instanceof(a,b)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(d,b){for(var a=0;a<b.length;a++){var c=b[a];c.enumerable=c.enumerable||false;c.configurable=true;if("value" in c){c.writable=true}Object.defineProperty(d,c.key,c)}}function _createClass(c,a,b){if(a){_defineProperties(c.prototype,a)}if(b){_defineProperties(c,b)}return c}var Tea=function(){function j(){_classCallCheck(this,j)}_createClass(j,null,[{key:"encrypt",value:function d(r,o){r=String(r);o=String(o);if(r.length==0){return""}var n=j.strToLongs(j.utf8Encode(r));var m=j.strToLongs(j.utf8Encode(o).slice(0,16));var q=j.encode(n,m);var l=j.longsToStr(q);var p=j.base64Encode(l);return p}},{key:"decrypt",value:function b(l,p){l=String(l);p=String(p);if(l.length==0){return""}var o=j.strToLongs(j.base64Decode(l));var n=j.strToLongs(j.utf8Encode(p).slice(0,16));var q=j.decode(o,n);var r=j.longsToStr(q);var m=j.utf8Decode(r.replace(/\0+$/,""));return m}},{key:"encode",value:function c(x,r){if(x.length<2){x[1]=0}var o=x.length;var B=2654435769;var l=Math.floor(6+52/o);var u=x[o-1],w=x[0];var A,t,s=0;while(l-->0){s+=B;t=s>>>2&3;for(var m=0;m<o;m++){w=x[(m+1)%o];A=(u>>>5^w<<2)+(w>>>3^u<<4)^(s^w)+(r[m&3^t]^u);u=x[m]+=A}}return x}},{key:"decode",value:function h(x,r){var o=x.length;var B=2654435769;var l=Math.floor(6+52/o);var u=x[o-1],w=x[0];var A,t,s=l*B;while(s!=0){t=s>>>2&3;for(var m=o-1;m>=0;m--){u=x[m>0?m-1:o-1];A=(u>>>5^w<<2)+(w>>>3^u<<4)^(s^w)+(r[m&3^t]^u);w=x[m]-=A}s-=B}return x}},{key:"strToLongs",value:function a(o){var m=new Array(Math.ceil(o.length/4));for(var n=0;n<m.length;n++){m[n]=o.charCodeAt(n*4)+(o.charCodeAt(n*4+1)<<8)+(o.charCodeAt(n*4+2)<<16)+(o.charCodeAt(n*4+3)<<24)}return m}},{key:"longsToStr",value:function f(m){var o="";for(var n=0;n<m.length;n++){o+=String.fromCharCode(m[n]&255,m[n]>>>8&255,m[n]>>>16&255,m[n]>>>24&255)}return o}},{key:"utf8Encode",value:function k(l){return unescape(encodeURIComponent(l))}},{key:"utf8Decode",value:function g(l){try{return decodeURIComponent(escape(l))}catch(m){return l}}},{key:"base64Encode",value:function e(l){if(typeof btoa!="undefined"){return btoa(l)}if(typeof Buffer!="undefined"){return new Buffer(l,"binary").toString("base64")}throw new Error("No Base64 Encode")}},{key:"base64Decode",value:function i(l){if(typeof atob=="undefined"&&typeof Buffer=="undefined"){throw new Error("No base64 decode")}try{if(typeof atob!="undefined"){return atob(l)}if(typeof Buffer!="undefined"){return new Buffer(l,"base64").toString("binary")}}catch(m){throw new Error("Invalid ciphertext")}}}]);return j}();var builtInCommands={};builtInCommands.cat={about:"cat [file]<br>&nbsp;&nbsp;Display the contents of the specified file.",exe:function(a){if(a.length!=2){return"No such file."}var b=term.catFile(a[1]);if(b===false){return"No such file, or argument is a directory."}b=(b+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2");return b}};builtInCommands.cd={about:"cd [path]<br>&nbsp;&nbsp;Change directory to the specified path.",exe:function(a){if(a.length!=2){return""}var b=term.changeDirectory(a[1]);if(!b){return"No such directory."}return""}};builtInCommands.clear={about:"clear<br>&nbsp;&nbsp;Clear the terminal window.",exe:function(){return""}};builtInCommands.echo={about:"echo [string]<br>&nbsp;&nbsp;Display a line of text.",exe:function(a){var b=a.slice();b.shift();return b.join(" ")}};builtInCommands.encrypt={about:"encrypt [message] [password]<br>&nbsp;&nbsp;Encrypt a provided message using the password.",exe:function(a){if(a.length!=3){return"encrypt: Invalid number of arguments."}var b=Tea.encrypt(a[1],a[2]);return b}};builtInCommands.decrypt={about:"decrypt [encoded] [password]<br>&nbsp;&nbsp;Decrypt a provided message using the password.",exe:function(a){if(a.length!=3){return"decrypt: Invalid number of arguments."}var b=Tea.decrypt(a[1],a[2]);return b}};builtInCommands.help={about:"help [command]<br>&nbsp;&nbsp;Show a list of available commands, or help for a specific command.",exe:function(a){var b="";if(a.length==2&&a[1]&&a[1].toLowerCase() in commands){b+="<strong>"+a[1].toLowerCase()+"</strong>: "+commands[a[1].toLowerCase()].about+""}else{b+="TERMFAKE bash, version "+version+"-release (x86_64-pc-linux-gnu)<br>These shell commands are defined internally.  Type 'help' to see this list.<br>Type 'help name' to find out more about the function 'name'.<br><br>";b+="";Object.keys(commands).sort().forEach(function(c){if(!commands[c].hidden){b+="<strong>"+c+"</strong>&nbsp; "}})}b+="<br><br>";return b}};builtInCommands.history={about:"history [-c]<br>&nbsp;&nbsp;Display the list of recent commands.<br>&nbsp;&nbsp;-c clear the history list.",exe:function(a){if(a.length==2&&a[1]=="-c"){localStorage.setItem("history",[]);term.history=[]}var c=term.history;var b="";c.forEach(function(e,d){b+=d+"&nbsp;&nbsp;"+e+"<br>"});return b}};builtInCommands.ls={about:"ls [-l]<br>&nbsp;&nbsp;List directory contents.<br>&nbsp;&nbsp;-l list contents vertically.",exe:function(a){var c="";var b=Array.prototype.slice.call(term.filesystemPointer.querySelector("c").children);b.forEach(function(e,d){c+="<span class='filesystem-"+e.nodeName+"'>"+e.getAttribute("name")+"</span>";if(a[1]&&a[1]=="-l"){c+="<br>"}else{c+="&nbsp;&nbsp;"}});return c}};builtInCommands.pwd={about:"pwd<br>&nbsp;&nbsp;Print the name of the current working directory.",exe:function(){return term.path}};builtInCommands.reboot={about:"reboot<br>&nbsp;&nbsp;Reboot the terminal and reset saved environment.",exe:function(){localStorage.removeItem("filesystem");localStorage.removeItem("history");term.initSession();term.bootTerminalStart(document.getElementById("terminal"));return""}};builtInCommands.rm={about:"rm [name]<br>&nbsp;&nbsp;Delete the file with the specified name in the current directory.",exe:function(a){if(a.length==1){return"No filename specified."}if(a.length>2){return"Too many parameters supplied."}var b=term.deleteFile(a[1]);if(b!==true){return b}return""}};builtInCommands.touch={about:"touch [name]<br>&nbsp;&nbsp;Create a file with the specified name in the current directory.",exe:function(a){if(a.length==1){return"No filename specified."}if(a.length>2){return"Too many parameters supplied."}var b=term.makeFile(a[1]);if(b!==true){return b}return""}};builtInCommands.version={about:"version<br>&nbsp;&nbsp;Display the version and attribution of this terminal application.",exe:function(){return"Terminal Faker: version "+version+" (https://github.com/syntaxseed/terminalfaker) by Sherri Wheeler."}};
